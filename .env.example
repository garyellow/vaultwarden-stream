# ===========================================================================
# Vaultwarden Stream — Environment Configuration
# ===========================================================================
#
# Quick Start:
#   1. cp .env.example .env
#   2. Fill in S3_BUCKET, S3_ENDPOINT, S3_ACCESS_KEY_ID, S3_SECRET_ACCESS_KEY
#   3. docker compose up -d
#
# Configuration Format:
#   KEY=value      — Required variables (must be filled in)
#   # KEY=value    — Optional variables (remove # to enable)
#
# ===========================================================================


# ── Required — S3-Compatible Storage ───────────────────────────────────────

## S3 provider (for rclone): Cloudflare, AWS, Minio, Backblaze, etc.
## Full list: https://rclone.org/s3/#s3-provider
S3_PROVIDER=Cloudflare

## S3 bucket name.
S3_BUCKET=

## S3 endpoint URL.
## Cloudflare R2:  https://<ACCOUNT_ID>.r2.cloudflarestorage.com
## AWS S3:         https://s3.<REGION>.amazonaws.com
## MinIO:          https://minio.example.com
S3_ENDPOINT=

## S3 credentials (shared by Litestream and rclone).
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=


# ── Optional — S3 ──────────────────────────────────────────────────────────

# S3_PREFIX=vaultwarden
# S3_REGION=auto
# S3_ACL=private


# ── Optional — Deployment ──────────────────────────────────────────────────

## Set the role: primary (main instance) or secondary (disaster recovery standby)
# NODE_ROLE=primary

## Set deployment mode: persistent (always running) or serverless (scale-to-zero)
# DEPLOYMENT_MODE=persistent

## How often to upload files to S3, in seconds (primary only)
# PRIMARY_SYNC_INTERVAL=300

## How often to refresh data from S3, in seconds (secondary persistent mode only)
# SECONDARY_SYNC_INTERVAL=3600

# HEALTHCHECK_SYNC_MAX_AGE=600


# ── Optional — Snapshot Backup ─────────────────────────────────────────────

## Enable periodic snapshot backups (tar.gz containing database + all files)
## Creates backups independent of Litestream, useful for migration or compliance
## Note: Not recommended for serverless mode as it prevents scale-to-zero
# BACKUP_ENABLED=false
# BACKUP_INTERVAL=86400
# BACKUP_RETENTION_DAYS=30
# BACKUP_MIN_KEEP=3

## Extra backup destinations (comma-separated remote:path)
## Configure remotes via rclone environment variables:
## https://rclone.org/docs/#configure-remotes-with-environment-variables

## Example 1 — Google Drive (requires OAuth token from `rclone config`):
## 1. Run: docker run --rm -it rclone/rclone config
## 2. Follow prompts to authorize Google Drive
## 3. Copy the token JSON from rclone.conf [gdrive] section
# RCLONE_CONFIG_GDRIVE_TYPE=drive
# RCLONE_CONFIG_GDRIVE_SCOPE=drive
# RCLONE_CONFIG_GDRIVE_TOKEN={"access_token":"xxx","token_type":"Bearer","refresh_token":"xxx","expiry":"2026-01-01T00:00:00Z"}
# BACKUP_EXTRA_REMOTES=GDRIVE:vaultwarden-backup

## Example 2 — SFTP (backup to a remote server):
# RCLONE_CONFIG_BACKUP_SFTP_TYPE=sftp
# RCLONE_CONFIG_BACKUP_SFTP_HOST=backup.example.com
# RCLONE_CONFIG_BACKUP_SFTP_USER=backupuser
# RCLONE_CONFIG_BACKUP_SFTP_PASS=obscured-password  # Obscure: echo "pass" | rclone obscure -
# RCLONE_CONFIG_BACKUP_SFTP_PORT=22
# BACKUP_EXTRA_REMOTES=BACKUP_SFTP:/backups/vaultwarden

## Multiple destinations (comma-separated, spaces OK):
# BACKUP_EXTRA_REMOTES=GDRIVE:vw-backup, BACKUP_SFTP:/backups/vw


# ── Optional — Litestream ──────────────────────────────────────────────────
## Docs: https://litestream.io/reference/config/

# LITESTREAM_SYNC_INTERVAL=1s
# LITESTREAM_SNAPSHOT_INTERVAL=30m
# LITESTREAM_RETENTION=24h
# LITESTREAM_DB_PATH=/data/db.sqlite3
# LITESTREAM_REPLICA_PATH=vaultwarden/db.sqlite3


# ── Optional — rclone ──────────────────────────────────────────────────────
## Docs: https://rclone.org/s3/

# RCLONE_REMOTE_NAME=S3
# RCLONE_FLAGS=


# ── Optional — Vaultwarden ─────────────────────────────────────────────────
## Docs: https://github.com/dani-garcia/vaultwarden/wiki/

# DOMAIN=https://vault.example.com

## Admin panel access token (leave empty to disable admin panel)
## Generate with: docker run --rm vaultwarden/server /vaultwarden hash --preset owasp
# ADMIN_TOKEN=

# SIGNUPS_ALLOWED=true
# SIGNUPS_VERIFY=false
# SIGNUPS_DOMAINS_WHITELIST=
# INVITATIONS_ALLOWED=true

## Enable WebSocket for real-time sync (recommended for persistent deployments)
## Disable for serverless: WebSocket connections prevent scale-to-zero; when disabled,
## clients will use polling (every 30 minutes) instead
# ENABLE_WEBSOCKET=true

# WEB_VAULT_ENABLED=true


# ── SMTP ───────────────────────────────────────────────────────────────────

# SMTP_HOST=smtp.example.com
# SMTP_PORT=587
# SMTP_SECURITY=starttls
# SMTP_USERNAME=
# SMTP_PASSWORD=
# SMTP_FROM=vaultwarden@example.com
# SMTP_FROM_NAME=Vaultwarden
# SMTP_TIMEOUT=15
# SMTP_EMBED_IMAGES=true
# SMTP_ACCEPT_INVALID_CERTS=false


# ── Push Notifications ─────────────────────────────────────────────────────
## Register at https://bitwarden.com/host/

# PUSH_ENABLED=false
# PUSH_INSTALLATION_ID=
# PUSH_INSTALLATION_KEY=
# PUSH_RELAY_URI=https://push.bitwarden.com
# PUSH_IDENTITY_URI=https://identity.bitwarden.com


# ── Security & Rate Limiting ───────────────────────────────────────────────

# LOGIN_RATELIMIT_SECONDS=60
# LOGIN_RATELIMIT_MAX_BURST=10
# ADMIN_RATELIMIT_SECONDS=300
# ADMIN_RATELIMIT_MAX_BURST=3
# ADMIN_SESSION_LIFETIME=20
# PASSWORD_ITERATIONS=600000
# DISABLE_2FA_REMEMBER=false
# REQUIRE_DEVICE_EMAIL=false
# IP_HEADER=X-Real-IP


# ── Logging ────────────────────────────────────────────────────────────────

# LOG_LEVEL=info
# EXTENDED_LOGGING=true
# LOG_TIMESTAMP_FORMAT=%Y-%m-%d %H:%M:%S.%3f
# LOG_FILE=


# ── Miscellaneous ──────────────────────────────────────────────────────────

# SENDS_ALLOWED=true
# EMERGENCY_ACCESS_ALLOWED=true
# EMAIL_CHANGE_ALLOWED=true
# ORG_EVENTS_ENABLED=false
# TRASH_AUTO_DELETE_DAYS=
# HIBP_API_KEY=
# SHOW_PASSWORD_HINT=false
# TZ=UTC
# ROCKET_PORT=80
# ROCKET_ADDRESS=0.0.0.0


# ── SSO / OpenID Connect (1.32.0+) ─────────────────────────────────────────

# SSO_ENABLED=false
# SSO_ONLY=false
# SSO_AUTHORITY=
# SSO_CLIENT_ID=
# SSO_CLIENT_SECRET=
# SSO_SCOPES=email profile
# SSO_PKCE=true


# ── YubiKey 2FA ────────────────────────────────────────────────────────────

# YUBICO_CLIENT_ID=
# YUBICO_SECRET_KEY=
# YUBICO_SERVER=


# ── Duo 2FA ────────────────────────────────────────────────────────────────

# DUO_IKEY=
# DUO_SKEY=
# DUO_HOST=
