# Vaultwarden Stream — Environment Configuration
#
# cp .env.example .env && docker compose up -d
# See README.md for full documentation.


# ── S3 Storage ───────────────────────────────────────────────────────────
# Required. Used by Litestream (database replication) and rclone (file sync).

# S3-compatible provider (AWS, Cloudflare R2, MinIO, etc.)
S3_PROVIDER=Cloudflare

# Bucket name
S3_BUCKET=

# Endpoint URL
S3_ENDPOINT=

# Access credentials
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=

# Path prefix inside bucket
# S3_PREFIX=vaultwarden

# Region (use "auto" for Cloudflare R2)
# S3_REGION=auto

# Object ACL
# S3_ACL=private

# Skip bucket existence check (required for R2 token-based auth)
# S3_NO_CHECK_BUCKET=true


# ── Deployment ───────────────────────────────────────────────────────────

# Node role: primary (read/write) or secondary (read-only standby)
# NODE_ROLE=primary

# Deployment mode: persistent (always-on) or serverless (scale-to-zero)
# DEPLOYMENT_MODE=persistent

# File sync interval in seconds (primary uploads, secondary downloads)
# PRIMARY_SYNC_INTERVAL=300
# SECONDARY_SYNC_INTERVAL=3600

# rclone remote name (alphanumeric and underscores only)
# RCLONE_REMOTE_NAME=S3

# Max seconds since last sync before healthcheck fails
# HEALTHCHECK_MAX_SYNC_AGE=600


# ── Litestream ───────────────────────────────────────────────────────────
# Continuous SQLite replication to S3 using write-ahead log (WAL).

# WAL sync interval (determines crash data-loss window)
# LITESTREAM_SYNC_INTERVAL=1s

# Full snapshot creation interval
# LITESTREAM_SNAPSHOT_INTERVAL=30m

# Snapshot and WAL retention period
# LITESTREAM_RETENTION=24h

# Local database file path
# LITESTREAM_DB_PATH=/data/db.sqlite3

# S3 replica path (auto-derived from S3_PREFIX)
# LITESTREAM_REPLICA_PATH=vaultwarden/db.sqlite3

# Seconds to flush WAL before forced shutdown
# LITESTREAM_SHUTDOWN_TIMEOUT=30

# Use path-style S3 URLs (required for MinIO, Ceph)
# LITESTREAM_FORCE_PATH_STYLE=false

# Skip TLS certificate verification (for self-signed certs)
# LITESTREAM_SKIP_VERIFY=false

# Automatic replica validation interval (restores and verifies S3 data)
# NOTE: Currently non-functional in Litestream v0.5.x (defined in schema but not implemented)
# When implemented in future versions, this will significantly increase S3 costs due to downloads
# Leave empty to disable (recommended until feature is available)
# LITESTREAM_VALIDATION_INTERVAL=


# ── Backup (Optional) ───────────────────────────────────────────────────
# Scheduled archives uploaded to rclone destinations.
# Reduces R2 operation costs compared to uploading individual files.

# Enable scheduled backups
# BACKUP_ENABLED=false

# Cron schedule (5 fields, uses TZ variable)
# BACKUP_CRON=0 0 * * *

# Archive format: tar.gz (compressed, supports encryption) or tar (uncompressed, faster)
# BACKUP_FORMAT=tar.gz

# Encryption password (requires tar.gz format, uses openssl AES-256-CBC)
# BACKUP_PASSWORD=

# Comma-separated remote destinations (required when enabled)
# Examples: S3:my-bucket/backups or GDRIVE:backups
# BACKUP_REMOTES=

# Delete backups older than N days
# BACKUP_RETENTION_DAYS=30

# Always keep at least N recent backups
# BACKUP_MIN_KEEP=3

# Include attachments in backup
# BACKUP_INCLUDE_ATTACHMENTS=true

# Include sends in backup
# BACKUP_INCLUDE_SENDS=true

# Include RSA keys and config.json in backup
# BACKUP_INCLUDE_CONFIG=true

# Include icon cache in backup (icons can be re-fetched, but backup speeds up recovery)
# BACKUP_INCLUDE_ICON_CACHE=false

# Run backup immediately on startup (in addition to scheduled backups)
# BACKUP_ON_STARTUP=false

# Seconds to wait for in-progress backup during shutdown
# BACKUP_SHUTDOWN_TIMEOUT=60


# ── Notifications (Optional) ────────────────────────────────────────────
# HTTP ping URL for monitoring events (compatible with Healthchecks.io, Cronitor, etc.)

# Base notification URL
# NOTIFICATION_URL=

# Events to notify (comma-separated): backup_success,backup_failure,sync_error
# Leave empty to notify on all events
# NOTIFICATION_EVENTS=backup_success,backup_failure,sync_error

# curl timeout in seconds for notification requests
# NOTIFICATION_TIMEOUT=10


# ── Advanced ────────────────────────────────────────────────────────────

# Additional rclone flags for all operations (use with caution)
# Example: --transfers 16 --checkers 32
# RCLONE_FLAGS=


# ── Tailscale (Optional) ────────────────────────────────────────────────
# Private mesh VPN, supports Tailscale cloud and self-hosted Headscale.

# Enable Tailscale VPN
# TAILSCALE_ENABLED=false

# Auth key for node registration
# TAILSCALE_AUTHKEY=

# Node hostname on your tailnet
# TAILSCALE_HOSTNAME=vaultwarden

# State directory (mount as volume to persist across restarts)
# TAILSCALE_STATE_DIR=/var/lib/tailscale

# Custom control server URL (for Headscale)
# TAILSCALE_LOGIN_SERVER=

# Local port to expose via Tailscale Serve (blank to disable Serve)
# TAILSCALE_SERVE_PORT=80

# Serve mode: https or tls-terminated-tcp
# TAILSCALE_SERVE_MODE=https

# Expose to public internet via Funnel (requires ACL policy)
# TAILSCALE_FUNNEL=false

# Additional flags for "tailscale up" command
# TAILSCALE_EXTRA_ARGS=


# ── Vaultwarden — General ───────────────────────────────────────────────

# Public URL of your instance (required for email links and U2F)
# DOMAIN=https://vault.example.com

# Admin panel token (generate with: docker run --rm vaultwarden/server /vaultwarden hash)
# ADMIN_TOKEN=

# Allow new user registration
# SIGNUPS_ALLOWED=true

# Require email verification for new signups
# SIGNUPS_VERIFY=false

# Restrict signups to specific email domains (comma-separated)
# SIGNUPS_DOMAINS_WHITELIST=

# Allow invitations from existing users
# INVITATIONS_ALLOWED=true

# Organization name shown in invitation emails
# INVITATION_ORG_NAME=Vaultwarden

# Enable Send feature
# SENDS_ALLOWED=true

# Enable emergency access feature
# EMERGENCY_ACCESS_ALLOWED=true

# Allow users to change email address
# EMAIL_CHANGE_ALLOWED=true

# Enable WebSocket notifications
# ENABLE_WEBSOCKET=true

# Enable web vault interface
# WEB_VAULT_ENABLED=true

# Enable organization event logs
# ORG_EVENTS_ENABLED=false

# Allow password hints
# PASSWORD_HINTS_ALLOWED=true

# Show password hints without login
# SHOW_PASSWORD_HINT=false

# Server listen port
# ROCKET_PORT=80

# Auto-delete trashed items after N days (blank to keep forever)
# TRASH_AUTO_DELETE_DAYS=

# Log level: trace, debug, info, warn, error
# LOG_LEVEL=info

# Timezone (used by backup scheduler)
# TZ=UTC


# ── Vaultwarden — SMTP ──────────────────────────────────────────────────

# SMTP server configuration (required for email verification, invitations, 2FA)
# SMTP_HOST=smtp.example.com
# SMTP_FROM=vaultwarden@example.com
# SMTP_FROM_NAME=Vaultwarden
# SMTP_USERNAME=
# SMTP_PASSWORD=

# Connection security: starttls, force_tls, or off
# SMTP_SECURITY=starttls
# SMTP_PORT=587

# Connection timeout in seconds
# SMTP_TIMEOUT=15


# ── Vaultwarden — Push Notifications ────────────────────────────────────

# Enable mobile push notifications (register at bitwarden.com/host)
# PUSH_ENABLED=false
# PUSH_INSTALLATION_ID=
# PUSH_INSTALLATION_KEY=


# ── Vaultwarden — Security ──────────────────────────────────────────────

# Login rate limiting (seconds / max attempts)
# LOGIN_RATELIMIT_SECONDS=60
# LOGIN_RATELIMIT_MAX_BURST=10

# Admin panel rate limiting (seconds / max attempts)
# ADMIN_RATELIMIT_SECONDS=300
# ADMIN_RATELIMIT_MAX_BURST=3

# Admin session lifetime in minutes
# ADMIN_SESSION_LIFETIME=20

# Password hash iterations (higher is more secure but slower)
# PASSWORD_ITERATIONS=600000

# Client IP header when behind reverse proxy
# IP_HEADER=X-Real-IP


# ── Vaultwarden — Two-Factor Authentication ─────────────────────────────

# YubiKey settings (get API key from upgrade.yubico.com/getapikey)
# YUBICO_CLIENT_ID=
# YUBICO_SECRET_KEY=

# Duo settings (register at duo.com)
# DUO_IKEY=
# DUO_SKEY=
# DUO_HOST=

# Email 2FA token configuration
# EMAIL_TOKEN_SIZE=6
# EMAIL_EXPIRATION_TIME=600
# EMAIL_2FA_AUTO_FALLBACK=false
