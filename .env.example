# ===========================================================================
# Vaultwarden Stream — Environment Configuration
# ===========================================================================
#
# Quick Start:
#   1. cp .env.example .env
#   2. Fill in S3_BUCKET, S3_ENDPOINT, S3_ACCESS_KEY_ID, S3_SECRET_ACCESS_KEY
#   3. docker compose up -d
#
# ===========================================================================


# ── Required ───────────────────────────────────────────────────────────────

## S3 provider: Cloudflare, AWS, Minio, Backblaze, etc.
## Full list: https://rclone.org/s3/#s3-provider
S3_PROVIDER=Cloudflare

## S3 bucket name
S3_BUCKET=

## S3 endpoint URL
## Cloudflare R2:  https://<ACCOUNT_ID>.r2.cloudflarestorage.com
## AWS S3:         https://s3.<REGION>.amazonaws.com
## MinIO:          https://minio.example.com
S3_ENDPOINT=

## S3 access credentials
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=


# ── Deployment ─────────────────────────────────────────────────────────────

## Instance role: primary (main) or secondary (disaster recovery)
# NODE_ROLE=primary

## Deployment mode: persistent (always-on) or serverless (scale-to-zero)
# DEPLOYMENT_MODE=persistent

## File sync interval (seconds) — how often to upload attachments/keys to S3
# PRIMARY_SYNC_INTERVAL=300

## Secondary refresh interval (seconds) — how often to sync from S3
# SECONDARY_SYNC_INTERVAL=3600


# ── S3 Advanced ────────────────────────────────────────────────────────────

## S3 path prefix for all data
# S3_PREFIX=vaultwarden

## S3 region (use "auto" for Cloudflare R2)
# S3_REGION=auto

## S3 object ACL
# S3_ACL=private

## Skip bucket check (required for Cloudflare R2 "Object Read & Write" tokens)
# S3_NO_CHECK_BUCKET=true


# ── Snapshot Backup ────────────────────────────────────────────────────────

## Enable scheduled full backups (tar.gz of database + all files)
# BACKUP_ENABLED=false

## Backup schedule (cron expression, local time per TZ)
## Format: minute hour day-of-month month day-of-week
## Examples: "0 0 * * *" (daily 0AM), "0 3 * * 0" (weekly Sun 3AM), "0 4 1 * *" (monthly 1st 4AM)
# BACKUP_CRON=0 0 * * *

## Delete backups older than N days
# BACKUP_RETENTION_DAYS=30

## Always keep at least N most recent backups
# BACKUP_MIN_KEEP=3

## Extra backup destinations (comma-separated, e.g., "GDRIVE:backup, SFTP:/backups")
## Requires rclone remote configuration via RCLONE_CONFIG_* environment variables
## See: https://rclone.org/docs/#configure-remotes-with-environment-variables
# BACKUP_EXTRA_REMOTES=


# ── Litestream ─────────────────────────────────────────────────────────────

## WAL replication interval (affects data loss window on catastrophic crashes)
# LITESTREAM_SYNC_INTERVAL=1s

## Snapshot creation interval
# LITESTREAM_SNAPSHOT_INTERVAL=30m

## Snapshot retention period
# LITESTREAM_RETENTION=24h

## Database file path
# LITESTREAM_DB_PATH=/data/db.sqlite3

## S3 replica path
# LITESTREAM_REPLICA_PATH=vaultwarden/db.sqlite3

## Graceful shutdown timeout (seconds) — increase for slower S3 connections
# LITESTREAM_SHUTDOWN_TIMEOUT=30

## Backup completion timeout (seconds) — increase for large databases
# BACKUP_SHUTDOWN_TIMEOUT=60


# ── Health Check ───────────────────────────────────────────────────────────

## Max age (seconds) before marking sync as unhealthy
# HEALTHCHECK_SYNC_MAX_AGE=600


# ── Vaultwarden ────────────────────────────────────────────────────────────
## Full documentation: https://github.com/dani-garcia/vaultwarden/wiki/

## Public URL of your Vaultwarden instance
# DOMAIN=https://vault.example.com

## Admin panel token (generate with: docker run --rm vaultwarden/server /vaultwarden hash)
# ADMIN_TOKEN=

## Allow new user registrations
# SIGNUPS_ALLOWED=true

## Require email verification for signups
# SIGNUPS_VERIFY=false

## Restrict signups to specific domains (comma-separated)
# SIGNUPS_DOMAINS_WHITELIST=

## Allow organization invitations
# INVITATIONS_ALLOWED=true

## Enable WebSocket for real-time sync (disable for serverless to allow scale-to-zero)
# ENABLE_WEBSOCKET=true

## Enable web vault UI
# WEB_VAULT_ENABLED=true


# ── SMTP ───────────────────────────────────────────────────────────────────

# SMTP_HOST=smtp.example.com
# SMTP_PORT=587
# SMTP_SECURITY=starttls
# SMTP_USERNAME=
# SMTP_PASSWORD=
# SMTP_FROM=vaultwarden@example.com
# SMTP_FROM_NAME=Vaultwarden


# ── Push Notifications ─────────────────────────────────────────────────────
## Register at: https://bitwarden.com/host/

# PUSH_ENABLED=false
# PUSH_INSTALLATION_ID=
# PUSH_INSTALLATION_KEY=


# ── Security ───────────────────────────────────────────────────────────────

## Login rate limiting
# LOGIN_RATELIMIT_SECONDS=60
# LOGIN_RATELIMIT_MAX_BURST=10

## Admin panel rate limiting
# ADMIN_RATELIMIT_SECONDS=300
# ADMIN_RATELIMIT_MAX_BURST=3

## Admin session lifetime (minutes)
# ADMIN_SESSION_LIFETIME=20

## Password hash iterations
# PASSWORD_ITERATIONS=600000

## IP header for rate limiting (use with reverse proxy)
# IP_HEADER=X-Real-IP


# ── Two-Factor Authentication ──────────────────────────────────────────────

## YubiKey
# YUBICO_CLIENT_ID=
# YUBICO_SECRET_KEY=

## Duo
# DUO_IKEY=
# DUO_SKEY=
# DUO_HOST=


# ── Miscellaneous ──────────────────────────────────────────────────────────

# LOG_LEVEL=info
# SENDS_ALLOWED=true
# EMERGENCY_ACCESS_ALLOWED=true
# EMAIL_CHANGE_ALLOWED=true

## Timezone for BACKUP_CRON schedule (IANA timezone, e.g., America/New_York, Asia/Tokyo)
# TZ=UTC
